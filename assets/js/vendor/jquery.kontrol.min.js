(function(f){var g,l,m,n,p,j=Math.max,k=Math.min;g={};g.d=f(document);g.t=function(a){return a.originalEvent.touches.length-1};l=function(){var a=this;this.cv=this.v=this.g=this.i=this.$=this.o=null;this.my=this.mx=this.y=this.x=0;this.c=this.$c=null;this.t=0;this.isInit=!1;this.rH=this.eH=this.cH=this.dH=this.sH=this.pColor=this.fgColor=null;this.run=function(){var b=function(b,c){for(var e in c)a.o[e]=c[e];a.init();a._configure()._draw()};if(!this.$.data("kontroled"))return this.$.data("kontroled",
!0),this.extend(),this.o=f.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:!0,readOnly:this.$.data("readonly"),noScroll:this.$.data("noScroll"),cursor:!0===this.$.data("cursor")&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")||0.35,width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",
inline:!1,start:null,draw:null,change:null,cancel:null,release:null},this.o),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(b){var c=f(this);a.i[b]=c;a.v[b]=c.val();c.bind("change",function(){var e={};e[b]=c.val();a.val(e)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.$.val(),""==this.v&&(this.v=this.o.min),this.$.bind("change",function(){a.val(a.$.val())})),!this.o.displayInput&&this.$.hide(),this.$c=f('<canvas width="'+this.o.width+'px" height="'+
this.o.height+'px"></canvas>'),this.c=this.$c[0].getContext("2d"),this.$.wrap(f('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>')).before(this.$c),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",b).parent().bind("configure",b),this._listen()._configure()._xy().init(),this.isInit=!0,this._draw(),this};this._draw=function(){var b=!0,d=document.createElement("canvas");d.width=a.o.width;
d.height=a.o.height;a.g=d.getContext("2d");a.clear();a.dH&&(b=a.dH());!1!==b&&a.draw();a.c.drawImage(d,0,0)};this._touch=function(b){var d=function(b){b=a.xy2val(b.originalEvent.touches[a.t].pageX,b.originalEvent.touches[a.t].pageY,"touch");b!=a.cv&&!(a.cH&&!1===a.cH(b))&&(a.change(b),a._draw())};this.t=g.t(b);if(!(this.sH&&!1===this.sH()))return d(b),g.d.bind("touchmove.k",d).bind("touchend.k",function(){g.d.unbind("touchmove.k touchend.k");a.rH&&!1===a.rH(a.cv)||a.val(a.cv)}),this};this._mouse=
function(b){var d=function(b){b=a.xy2val(b.pageX,b.pageY,"mouse");b!=a.cv&&!(a.cH&&!1===a.cH(b))&&(a.change(b),a._draw())};if(!(this.sH&&!1===this.sH()))return a.mx=b.pageX,a.my=b.pageY,d(b),g.d.bind("mousemove.k",d).bind("keyup.k",function(b){27===b.keyCode&&(g.d.unbind("mouseup.k mousemove.k keyup.k"),a.eH&&!1===a.eH()||a.cancel())}).bind("mouseup.k",function(){g.d.unbind("mousemove.k mouseup.k keyup.k");a.rH&&!1===a.rH(a.cv)||a.val(a.cv)}),this};this._xy=function(){var a=this.$c.offset();this.x=
a.left;this.y=a.top;return this};this._listen=function(){this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(b){b.preventDefault();a._xy()._mouse(b)}).bind("touchstart",function(b){b.preventDefault();a._xy()._touch(b)}),this.listen());return this};this._configure=function(){this.o.start&&(this.sH=this.o.start);this.o.draw&&(this.dH=this.o.draw);this.o.change&&(this.cH=this.o.change);this.o.cancel&&(this.eH=this.o.cancel);this.o.release&&(this.rH=this.o.release);this.o.displayPrevious?
(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor;return this};this._clear=function(){this.$c[0].width=this.$c[0].width};this.listen=function(){};this.extend=function(){};this.init=function(){};this.change=function(){};this.val=function(){};this.xy2val=function(){};this.draw=function(){};this.clear=function(){this._clear()};this.h2rgba=function(a,d){var c;a=a.substring(1,7);c=[parseInt(a.substring(0,2),16),parseInt(a.substring(2,
4),16),parseInt(a.substring(4,6),16)];return"rgba("+c[0]+","+c[1]+","+c[2]+","+d+")"};this.copy=function(a,d){for(var c in a)d[c]=a[c]}};m=function(){l.call(this);this.w2=this.cursorExt=this.lineWidth=this.radius=this.xy=this.startAngle=null;this.PI2=2*Math.PI;this.extend=function(){this.o=f.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,flatMouse:this.$.data("flatMouse"),inline:!0},this.o)};this.val=function(a){if(null!=
a)this.v=this.cv=this.o.stopper?j(k(a,this.o.max),this.o.min):a,this.$.val(this.v),this._draw();else return this.v};this.xy2val=function(a,b,d){"mouse"===d&&this.o.flatMouse?(a=(this.my-b+(a-this.mx))/this.o.height,a=~~(a*(this.o.max-this.o.min)+parseFloat(this.v)),a=j(k(a,this.o.max),this.o.min)):(a=Math.atan2(a-(this.x+this.w2),-(b-this.y-this.w2))-this.angleOffset,this.angleArc!=this.PI2&&0>a&&-0.5<a?a=0:0>a&&(a+=this.PI2),a=~~(0.5+a*(this.o.max-this.o.min)/this.angleArc)+this.o.min);this.o.stopper&&
(a=j(k(a,this.o.max),this.o.min));return a};this.listen=function(){var a=this,b=function(b){if(!a.o.noScroll){b.preventDefault();var c=b.originalEvent;b=c.detail||c.wheelDeltaX;c=c.detail||c.wheelDeltaY;b=parseInt(a.$.val())+(0<b||0<c?1:0>b||0>c?-1:0);a.cH&&!1===a.cH(b)||a.val(b)}},d,c,e=1,g={37:-1,38:1,39:1,40:-1};this.$.bind("keydown",function(b){var h=b.keyCode;96<=h&&105>=h&&(h=b.keyCode=h-48);d=parseInt(String.fromCharCode(h));isNaN(d)&&(13!==h&&8!==h&&9!==h&&189!==h&&b.preventDefault(),-1<f.inArray(h,
[37,38,39,40])&&(b.preventDefault(),b=parseInt(a.$.val())+g[h]*e,a.o.stopper&&(b=j(k(b,a.o.max),a.o.min)),a.change(b),a._draw(),c=window.setTimeout(function(){e*=2},30)))}).bind("keyup",function(){isNaN(d)?c&&(window.clearTimeout(c),c=null,e=1,a.val(a.$.val())):a.$.val()>a.o.max&&a.$.val(a.o.max)||a.$.val()<a.o.min&&a.$.val(a.o.min)});this.$c.bind("mousewheel DOMMouseScroll",b);this.$.bind("mousewheel DOMMouseScroll",b)};this.init=function(){if(this.v<this.o.min||this.v>this.o.max)this.v=this.o.min;
this.$.val(this.v);this.w2=this.o.width/2;this.cursorExt=this.o.cursor/100;this.xy=this.w2;this.lineWidth=this.xy*this.o.thickness;this.radius=this.xy-this.lineWidth/2;this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset);this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc);this.angleOffset=this.o.angleOffset*Math.PI/180;this.angleArc=this.o.angleArc*Math.PI/180;this.startAngle=1.5*Math.PI+this.angleOffset;this.endAngle=1.5*Math.PI+this.angleOffset+
this.angleArc;var a=j(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.o.width/2+4>>0)+"px",height:(this.o.width/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.o.width/3>>0)+"px","margin-left":"-"+(3*this.o.width/4+2>>0)+"px",border:0,background:"none",font:"bold "+(this.o.width/a>>0)+"px Arial","text-align":"center",color:this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",
visibility:"hidden"})};this.change=function(a){this.cv=a;this.$.val(a)};this.angle=function(a){return(a-this.o.min)*this.angleArc/(this.o.max-this.o.min)};this.draw=function(){var a=this.g,b=this.angle(this.cv),d=this.startAngle,b=d+b,c,e;c=1;a.lineWidth=this.lineWidth;this.o.cursor&&(d=b-this.cursorExt)&&(b+=this.cursorExt);a.beginPath();a.strokeStyle=this.o.bgColor;a.arc(this.xy,this.xy,this.radius,this.endAngle,this.startAngle,!0);a.stroke();this.o.displayPrevious&&(e=this.startAngle+this.angle(this.v),
c=this.startAngle,this.o.cursor&&(c=e-this.cursorExt)&&(e+=this.cursorExt),a.beginPath(),a.strokeStyle=this.pColor,a.arc(this.xy,this.xy,this.radius,c,e,!1),a.stroke(),c=this.cv==this.v);a.beginPath();a.strokeStyle=c?this.o.fgColor:this.fgColor;a.arc(this.xy,this.xy,this.radius,d,b,!1);a.stroke()};this.cancel=function(){this.val(this.v)}};f.fn.dial=f.fn.knob=function(a){return this.each(function(){var b=new m;b.o=a;b.$=f(this);b.run()}).parent()};n=function(){l.call(this);this.m=[];this.p=[];this.f=
[];this.s={"0":1,1:-1};this.cursor=this.cur2=0;this.v={};this.div=null;this.extend=function(){this.o=f.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,width:this.$.data("width")||200,height:this.$.data("height")||200},this.o)};this._coord=function(){for(var a in this.v)this.m[a]=~~(0.5+(this.s[a]*this.v[a]-this.o.min)/this.f[a]+this.cur2),this.p[a]=this.m[a]};this.init=function(){this.cursor=this.o.cursor||30;this.cur2=this.cursor/2;this.f[0]=(this.o.max-this.o.min)/(this.o.width-this.cursor);
this.f[1]=(this.o.max-this.o.min)/(this.o.height-this.cursor);this.isInit||this._coord();if(this.o.displayInput){var a=this;this.$.css({"margin-top":"-30px",border:0,font:"11px Arial"});this.i.each(function(){f(this).css({width:a.o.width/4+"px",border:0,background:"none",color:a.o.fgColor,padding:"0px","-webkit-appearance":"none"})})}else this.$.css({width:"0px",visibility:"hidden"})};this.xy2val=function(a,b){this.m[0]=j(this.cur2,k(a-this.x,this.o.width-this.cur2));this.m[1]=j(this.cur2,k(b-this.y,
this.o.height-this.cur2));return{"0":~~(this.o.min+(this.m[0]-this.cur2)*this.f[0]),1:~~(this.o.min+(this.o.height-this.m[1]-this.cur2)*this.f[1])}};this.change=function(a){this.cv=a;this.i[0].val(this.cv[0]);this.i[1].val(this.cv[1])};this.val=function(a){if(null!==a)this.cv=a,this.copy(this.cv,this.v),this._coord(),this._draw();else return this.v};this.cancel=function(){this.copy(this.v,this.cv);this.i[0].val(this.cv[0]);this.i[1].val(this.cv[1]);this.m[0]=this.p[0];this.m[1]=this.p[1];this._draw()};
this.draw=function(){var a=this.g,b=1;this.o.displayPrevious&&(a.beginPath(),a.lineWidth=this.cursor,a.strokeStyle=this.pColor,a.moveTo(this.p[0],this.p[1]+this.cur2),a.lineTo(this.p[0],this.p[1]-this.cur2),a.stroke(),b=this.cv[0]==this.v[0]&&this.cv[1]==this.v[1]);a.beginPath();a.lineWidth=this.cursor;a.strokeStyle=b?this.o.fgColor:this.fgColor;a.moveTo(this.m[0],this.m[1]+this.cur2);a.lineTo(this.m[0],this.m[1]-this.cur2);a.stroke()}};f.fn.xy=function(a){return this.each(function(){var b=new n;
b.$=f(this);b.o=a;b.run()}).parent()};p=function(){l.call(this);this.fontSize=this.colWidth=this.col=this.mid=this.bar=null;this.displayMidLine=!1;this.extend=function(){this.o=f.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,width:this.$.data("width")||600,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),height:this.$.data("height")||200,fgColor:this.$.data("fgcolor")||"#87CEEB",bgColor:this.$.data("bgcolor")||"#CCCCCC",cols:this.$.data("cols")||8,spacing:this.$.data("spacing")||
1},this.o);1==this.o.cols&&(this.o.spacing=0);this.colWidth=(this.o.width-this.o.spacing*this.o.cols)/this.o.cols>>0;this.o.displayInput&&(this.fontSize=j(~~(this.colWidth/3),10),this.o.height-=this.fontSize)};this.xy2val=function(a,b){var d=this.colWidth+this.o.spacing,c=j(this.o.min,k(this.o.max,-(-this.mid+(b-this.y))/this.bar))>>0,e={};this.col=j(0,k(this.o.cols-1,(a-this.x)/d>>0));e[this.col]=c;return e};this.init=function(){this.bar=this.o.height/(this.o.max-this.o.min);this.mid=this.o.max*
this.bar>>0;this.displayMidLine=this.o.cursor&&0>this.o.min;if(this.o.displayInput){var a=this;this.$.css({margin:"0px",border:0,padding:"0px"});this.i.each(function(){f(this).css({width:a.colWidth-4+a.o.spacing+"px",border:0,background:"none",font:a.fontSize+"px Arial",color:a.o.fgColor,margin:"0px",padding:"0px","-webkit-appearance":"none","text-align":"center"})})}else this.$.css({width:"0px",visibility:"hidden"})};this.change=function(a){for(var b in a)this.cv[b]=a[b],this.i[b].val(this.cv[b])};
this.val=function(a){if(null!==a)this.copy(a,this.cv),this.copy(this.cv,this.v),this.col=null,this._draw();else return this.v};this.cancel=function(){this.copy(this.v,this.cv);this.col=null;this._draw()};this._bar=function(a){var b=a*(this.colWidth+this.o.spacing)+this.colWidth/2;this.displayMidLine&&(this.g.beginPath(),this.g.lineWidth=this.colWidth,this.g.strokeStyle=this.o.fgColor,this.g.moveTo(b,this.mid),this.g.lineTo(b,this.mid+1),this.g.stroke());this.o.displayPrevious&&(this.g.beginPath(),
this.g.lineWidth=this.colWidth,this.g.strokeStyle=this.cv[a]==this.v[a]?this.o.fgColor:this.pColor,this.o.cursor?this.g.lineTo(b,this.mid-(this.v[a]*this.bar>>0)+this.o.cursor/2):this.g.moveTo(b,this.mid),this.g.lineTo(b,this.mid-(this.v[a]*this.bar>>0)-this.o.cursor/2),this.g.stroke());this.g.beginPath();this.g.lineWidth=this.colWidth;this.g.strokeStyle=this.fgColor;this.o.cursor?this.g.lineTo(b,this.mid-(this.cv[a]*this.bar>>0)+this.o.cursor/2):this.g.moveTo(b,this.mid);this.g.lineTo(b,this.mid-
(this.cv[a]*this.bar>>0)-this.o.cursor/2);this.g.stroke()};this.clear=function(){this.col?this.c.clearRect(this.col*(this.colWidth+this.o.spacing),0,this.colWidth+this.o.spacing,this.o.height):this._clear()};this.draw=function(){if(this.col)this._bar(this.col);else for(var a=0;a<this.o.cols;a++)this._bar(a)}};f.fn.bars=function(a){return this.each(function(){var b=new p;b.$=f(this);b.o=a;b.run()}).parent()}})(jQuery);